<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spieler Details</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; padding-bottom: 140px; }
        .debug-panel { background: #222; color: #fff; border-radius: 10px; padding: 15px; font-family: 'Courier New', monospace; font-size: 13px; position: fixed; left: 20px; right: 20px; bottom: 20px; max-height: 120px; overflow-y: auto; z-index: 9999; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .debug-panel .debug-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .debug-panel .debug-clear-btn { background: #e74c3c; color: #fff; border: none; border-radius: 4px; padding: 3px 10px; font-size: 12px; cursor: pointer; }
        .debug-toggle-btn { position: fixed; bottom: 150px; left: 20px; background: #3498db; color: #fff; border: none; border-radius: 5px; padding: 5px 12px; font-size: 13px; cursor: pointer; z-index: 10000; }
        .navbar { background: linear-gradient(135deg, #34495e, #2c3e50); color: white; padding: 10px 15px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .back-btn { background: rgba(255,255,255,0.2); border: none; color: white; font-size: 16px; cursor: pointer; padding: 5px 10px; border-radius: 5px; transition: all 0.3s ease; }
        .player-header { display: flex; align-items: center; gap: 10px; flex: 1; }
        .club-logo { width: 35px; height: 35px; border-radius: 50%; background: linear-gradient(135deg, #3498db, #2980b9); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px; }
        .player-name { font-size: 18px; font-weight: bold; }
        .status-icon { padding: 4px 8px; border-radius: 15px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
        .status-aktiv { background: linear-gradient(135deg, #27ae60, #229954); }
        .status-verletzt { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .status-reha { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .status-nicht_in_liga { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; }
        .info-card { background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .info-card h3 { margin-bottom: 12px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px; font-size: 16px; }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 8px; padding: 5px 0; border-bottom: 1px solid #eee; }
        .info-row:last-child { border-bottom: none; }
        .info-label { font-weight: 600; color: #7f8c8d; font-size: 13px; }
        .info-value { font-weight: 600; color: #2c3e50; font-size: 13px; }
        .loading-spinner { display: inline-block; width: 25px; height: 25px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-message { text-align: center; color: #e74c3c; font-size: 16px; margin: 20px; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 10px; }
    </style>
</head>
<body>
    <button class="debug-toggle-btn" onclick="toggleDebugPanel()">üêû Debug</button>
    <div class="debug-panel" id="debugPanel">
        <div class="debug-header">
            <span><b>Debug-Informationen</b></span>
            <button class="debug-clear-btn" onclick="clearDebug()">L√∂schen</button>
        </div>
        <div id="debugContent"></div>
    </div>
    <nav class="navbar">
        <button class="back-btn" onclick="goBack()">‚Üê Zur√ºck</button>
        <div class="player-header">
            <div class="club-logo" id="clubLogo">?</div>
            <span class="player-name" id="playerName">Lade Spieler...</span>
            <span class="status-icon" id="statusIcon">Status</span>
        </div>
    </nav>
    <div class="container">
        <div id="loadingIndicator" class="loading-spinner"></div>
        <div id="errorMessage" class="error-message" style="display: none;"></div>
        <div id="playerContent" style="display: none;">
            <div class="info-card">
                <h3>üìã Spieler-Informationen</h3>
                <div class="info-row"><span class="info-label">Geburtstag:</span><span class="info-value" id="birthday">-</span></div>
                <div class="info-row"><span class="info-label">Alter:</span><span class="info-value" id="age">-</span></div>
                <div class="info-row"><span class="info-label">Gr√∂√üe:</span><span class="info-value" id="height">-</span></div>
                <div class="info-row"><span class="info-label">Nationalit√§t:</span><span class="info-value" id="nationality">-</span></div>
                <div class="info-row"><span class="info-label">Position:</span><span class="info-value" id="position">-</span></div>
                <div class="info-row"><span class="info-label">Hauptfu√ü:</span><span class="info-value" id="foot">-</span></div>
                <div class="info-row"><span class="info-label">Trikotnummer:</span><span class="info-value" id="jerseyNumber">-</span></div>
            </div>
        </div>
    </div>
    <script>
        let debugMode = true;
        function toggleDebugPanel() { debugMode = !debugMode; document.getElementById('debugPanel').style.display = debugMode ? 'block' : 'none'; }
        function logDebug(msg) {
            if (!debugMode) return;
            const debugContent = document.getElementById('debugContent');
            const timestamp = new Date().toLocaleTimeString('de-DE');
            debugContent.innerHTML += `<div>[${timestamp}] ${msg}</div>`;
            debugContent.scrollTop = debugContent.scrollHeight;
        }
        function clearDebug() { document.getElementById('debugContent').innerHTML = ''; }

        function getPlayerId() {
    // Vollst√§ndige URL-Informationen loggen
    logDebug('=== URL DEBUGGING START ===');
    logDebug('window.location.href: ' + window.location.href);
    logDebug('window.location.search: "' + window.location.search + '"');
    logDebug('window.location.search.length: ' + window.location.search.length);
    
    // URLSearchParams erstellen und debuggen
    const urlParams = new URLSearchParams(window.location.search);
    logDebug('URLSearchParams erstellt');
    
    // Alle Parameter ausgeben
    logDebug('Alle URL-Parameter:');
    for (const [key, value] of urlParams.entries()) {
        logDebug('  - ' + key + ' = "' + value + '"');
    }
    
    // Spezifisch nach 'id' suchen
    const playerId = urlParams.get('id');
    logDebug('urlParams.get("id"): "' + playerId + '"');
    logDebug('typeof playerId: ' + typeof playerId);
    logDebug('playerId === null: ' + (playerId === null));
    logDebug('playerId === "": ' + (playerId === ""));
    logDebug('playerId length: ' + (playerId ? playerId.length : 'null'));
    
    // Alternative Methoden testen
    logDebug('urlParams.has("id"): ' + urlParams.has('id'));
    
    // Manuelle URL-Parsing als Backup
    const url = window.location.href;
    const idMatch = url.match(/[?&]id=([^&]*)/);
    logDebug('Manual regex match: ' + (idMatch ? idMatch[1] : 'null'));
    
    logDebug('=== URL DEBUGGING END ===');
    
    // Fehlerbehandlung verbessert
    if (!playerId || playerId === null || playerId === '') {
        const errorMsg = 'Keine Spieler-ID in der URL gefunden!';
        logDebug('‚ùå ' + errorMsg);
        logDebug('Zeige Fehlermeldung an...');
        
        document.getElementById('errorMessage').textContent = errorMsg;
        document.getElementById('errorMessage').style.display = 'block';
        document.getElementById('loadingIndicator').style.display = 'none';
        return null;
    }
    
    logDebug('‚úÖ Spieler-ID erfolgreich extrahiert: "' + playerId + '"');
    return playerId;
}
// Backup-Funktion f√ºr den Fall, dass URLSearchParams nicht funktioniert
function getPlayerIdManual() {
    logDebug('=== MANUAL URL PARSING ===');
    const url = window.location.href;
    logDebug('URL: ' + url);
    
    // Verschiedene Patterns testen
    const patterns = [
        /[?&]id=([^&]*)/,     // Standard: ?id=123 oder &id=123
        /\/id\/([^\/]*)/,     // Path: /id/123
        /#id=([^&]*)/,        // Hash: #id=123
        /player\.html\?(.*)id=([^&]*)/  // Spezifisch f√ºr player.html
    ];
    
    for (let i = 0; i < patterns.length; i++) {
        const match = url.match(patterns[i]);
        if (match) {
            const id = match[match.length - 1]; // Letzter capture group
            logDebug('Pattern ' + i + ' matched: "' + id + '"');
            return id;
        }
    }
    
    logDebug('Keine ID in URL gefunden');
    return null;
}

        function goBack() { window.location.href = "index.html"; }
        function calcAge(birthday) {
            if (!birthday || birthday === 'N/A') return '-';
            const birthDate = new Date(birthday.split('.').reverse().join('-'));
            const diff = Date.now() - birthDate.getTime();
            const ageDate = new Date(diff);
            return Math.abs(ageDate.getUTCFullYear() - 1970) + ' Jahre';
        }

       document.addEventListener('DOMContentLoaded', async () => {
    logDebug('üöÄ player.html wird geladen...');
    
    // Beide Methoden testen
    let playerId = getPlayerId();
    
    if (!playerId) {
        logDebug('‚ö†Ô∏è Standard-Methode fehlgeschlagen, versuche manuelle Extraktion...');
        playerId = getPlayerIdManual();
    }
    
    if (!playerId) {
        logDebug('‚ùå Alle Methoden zur ID-Extraktion fehlgeschlagen!');
        return;
    }
    
    logDebug('‚úÖ Verwende Spieler-ID: "' + playerId + '"');
    
    try {
        logDebug('üì° Lade Spielerdaten f√ºr ID: ' + playerId);
        const resp = await fetch('https://raw.githubusercontent.com/torresbig/comunioFanApp/main/SpielerdatenbankNeutralJson.txt');
        
        if (!resp.ok) {
            throw new Error(`HTTP ${resp.status}`);
        }
        
        const allPlayers = await resp.json();
        logDebug('üìä ' + allPlayers.length + ' Spieler geladen');
        
        // Verschiedene ID-Vergleiche testen
        logDebug('üîç Suche Spieler mit ID: "' + playerId + '"');
        
        let player = allPlayers.find(p => String(p.id) === String(playerId));
        if (!player) {
            logDebug('‚ö†Ô∏è Exact match fehlgeschlagen, versuche andere Vergleiche...');
            player = allPlayers.find(p => p.id == playerId);
        }
        if (!player) {
            logDebug('‚ö†Ô∏è Loose match fehlgeschlagen, versuche parseInt...');
            const playerIdNum = parseInt(playerId);
            player = allPlayers.find(p => parseInt(p.id) === playerIdNum);
        }
        
        if (!player) {
            logDebug('‚ùå Spieler mit ID "' + playerId + '" nicht gefunden!');
            logDebug('üìã Verf√ºgbare IDs (erste 10): ' + allPlayers.slice(0, 10).map(p => p.id).join(', '));
            
            document.getElementById('errorMessage').textContent = "Spieler mit ID " + playerId + " nicht gefunden!";
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('loadingIndicator').style.display = 'none';
            return;
        }
        
        logDebug('‚úÖ Spieler gefunden: ' + player.name + ' (ID: ' + player.id + ')');
        
        // Rest der Anzeige-Logik...
        // ... (hier w√ºrde der Rest des Codes stehen)
        
    } catch (err) {
        logDebug('üí• Fehler beim Laden: ' + err.message);
        document.getElementById('errorMessage').textContent = "Fehler beim Laden der Daten: " + err.message;
        document.getElementById('errorMessage').style.display = 'block';
        document.getElementById('loadingIndicator').style.display = 'none';
    }
});

    </script>
</body>
</html>
