<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spieler Details</title>
    <style>
        /* Urspr√ºngliches CSS bleibt erhalten */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; padding-bottom: 140px; }
        /* ... (vorhandene Stile beibehalten) ... */

        /* Neue Stile f√ºr Zentrierung und Tabs */
        .player-header-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-align: center;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            border-bottom: 1px solid #ddd;
        }

        .tab-button {
            padding: 10px 20px;
            background: #2c3e50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            margin: 0 5px;
            border-radius: 5px 5px 0 0;
            transition: background 0.3s;
        }

        .tab-button.active {
            background: #3498db;
        }

        .tab-content {
            display: none;
            padding: 15px;
            background: rgba(255,255,255,0.95);
            border-radius: 0 0 10px 10px;
        }

        .tab-content.active {
            display: block;
        }

        .collapse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 10px 0;
        }

        .collapse-icon {
            font-size: 20px;
        }

        .info-card-content {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        /* Weitere Anpassungen f√ºr die Darstellung */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-box {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <button class="debug-toggle-btn" onclick="toggleDebugPanel()">üêû Debug</button>
    <div class="debug-panel" id="debugPanel">
        <div class="debug-header">
            <span><b>Debug-Informationen</b></span>
            <button class="debug-clear-btn" onclick="clearDebug()">L√∂schen</button>
        </div>
        <div id="debugContent"></div>
    </div>
    
    <nav class="navbar">
        <button class="back-btn" onclick="goBack()">‚Üê Zur√ºck</button>
        <div class="player-header">
            <div class="player-header-center">
                <div class="club-logo" id="clubLogo">?</div>
                <a href="#" id="playerNameLink" class="player-name" target="_blank">Lade Spieler...</a>
                <span class="status-icon" id="statusIcon">Status</span>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div id="loadingIndicator" class="loading-spinner"></div>
        <div id="errorMessage" class="error-message" style="display: none;"></div>
        
        <div id="playerContent" style="display: none;">
            <!-- Einklappbare Abschnitte -->
            <details class="info-card" open>
                <summary class="collapse-header">
                    <h3>üìã Spieler-Informationen</h3>
                    <span class="collapse-icon">‚ñº</span>
                </summary>
                <div class="info-card-content">
                    <div class="info-row">
                        <span class="info-label">Geburtstag:</span>
                        <span class="info-value" id="birthday">-</span>
                    </div>
                    <!-- ... (weitere Spielerinfos) ... -->
                </div>
            </details>

            <details class="info-card">
                <summary class="collapse-header">
                    <h3>‚öΩ Comunio</h3>
                    <span class="collapse-icon">‚ñº</span>
                </summary>
                <div class="info-card-content">
                    <!-- ... (Comunio-Inhalt) ... -->
                </div>
            </details>

            <details class="info-card">
                <summary class="collapse-header">
                    <h3>üìä Status & Statistik</h3>
                    <span class="collapse-icon">‚ñº</span>
                </summary>
                <div class="info-card-content">
                    <!-- ... (Status-Inhalt) ... -->
                </div>
            </details>

            <!-- Tabs f√ºr zus√§tzliche Daten -->
            <div class="tabs">
                <button class="tab-button active" data-tab="rivals">Rivalen</button>
                <button class="tab-button" data-tab="market">Marktwerte</button>
                <button class="tab-button" data-tab="points">Punkte</button>
            </div>

            <div id="rivals" class="tab-content active">
                <h3>‚öîÔ∏è Direkte Konkurrenten</h3>
                <div id="rivalsList"></div>
            </div>

            <div id="market" class="tab-content">
                <h3>üí∂ Marktwertentwicklung</h3>
                <div id="marketValueChart"></div>
            </div>

            <div id="points" class="tab-content">
                <h3>üìà Punkteverlauf</h3>
                <div class="stats-grid" id="pointsHistory"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Globale Variablen
        let currentPlayer = null;
        let allPlayersData = [];
        
        // Debug-Funktionen (bestehend) beibehalten
        // ... (logDebug, clearDebug, toggleDebugPanel) ...

        // Neue Funktionen f√ºr Tabs und Datenverarbeitung
        function initTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Aktiven Tab zur√ºcksetzen
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    
                    // Neuen Tab aktivieren
                    button.classList.add('active');
                    const tabId = button.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        function getPlayerId() {
            // ... (bestehende Implementierung) ...
        }
        
        async function loadAllPlayers() {
            try {
                const resp = await fetch('https://raw.githubusercontent.com/torresbig/comunioFanApp/main/SpielerdatenbankNeutralJson.txt');
                return await resp.json();
            } catch (error) {
                logDebug('Fehler beim Laden aller Spieler: ' + error.message);
                return [];
            }
        }
        
        function displayRivals(player) {
            const container = document.getElementById('rivalsList');
            if (!container) return;
            
            // Logik zur Identifizierung von Konkurrenten
            const rivals = allPlayersData.filter(p => 
                p.data?.position === player.data?.position && 
                p.id !== player.id
            ).slice(0, 5);
            
            if (rivals.length > 0) {
                let html = '<ul>';
                rivals.forEach(rival => {
                    html += `<li><b>${rival.name}</b> (${rival.data?.wert ? formatCurrencyShort(rival.data.wert) : '-'})</li>`;
                });
                html += '</ul>';
                container.innerHTML = html;
            } else {
                container.innerHTML = '<p>Keine direkten Konkurrenten gefunden</p>';
            }
        }
        
        function displayMarketValue(player) {
            const container = document.getElementById('marketValueChart');
            if (!container) return;
            
            // Marktwertanalyse
            const currentValue = player.data?.wert || 0;
            const valueHistory = player.data?.wertHistorie || [];
            
            let html = `<div class="stat-box">
                <strong>Aktueller Marktwert:</strong>
                <div>${formatCurrencyShort(currentValue)}</div>
            </div>`;
            
            if (valueHistory.length > 0) {
                html += '<h4>Historische Werte:</h4><ul>';
                valueHistory.forEach(entry => {
                    html += `<li>${entry.key}: ${formatCurrencyShort(entry.value)}</li>`;
                });
                html += '</ul>';
            }
            
            container.innerHTML = html;
        }
        
        function displayPointsHistory(player) {
            const container = document.getElementById('pointsHistory');
            if (!container) return;
            
            // Punktehistorie anzeigen
            const pointsHistory = player.data?.punkteHistorie || [];
            const currentPoints = player.data?.punkte || 0;
            
            let html = `
                <div class="stat-box">
                    <strong>Aktuelle Saison:</strong>
                    <div>${currentPoints} Punkte</div>
                </div>
            `;
            
            pointsHistory.forEach(season => {
                html += `
                    <div class="stat-box">
                        <strong>Saison ${season.key}:</strong>
                        <div>${season.value} Punkte</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Hauptfunktion mit erweitertem Datenhandling
        document.addEventListener('DOMContentLoaded', async () => {
            logDebug('player.html geladen');
            initTabs();
            
            const playerId = getPlayerId();
            if (!playerId) return;
            
            try {
                // Alle Spielerdaten laden
                allPlayersData = await loadAllPlayers();
                logDebug(`Gesamtspieler geladen: ${allPlayersData.length}`);
                
                // Aktuellen Spieler finden
                currentPlayer = allPlayersData.find(p => String(p.id) === String(playerId));
                if (!currentPlayer) {
                    // ... (Fehlerbehandlung) ...
                    return;
                }
                
                // ... (bestehende Anzeigelogik) ...
                
                // Neue Tab-Daten anzeigen
                displayRivals(currentPlayer);
                displayMarketValue(currentPlayer);
                displayPointsHistory(currentPlayer);
                
                // ... (restliche Initialisierung) ...
                
            } catch (err) {
                // ... (Fehlerbehandlung) ...
            }
        });
        
        // Vorhandene Hilfsfunktionen beibehalten
        // ... (getLogoFileName, loadClubData, calcAge, etc.) ...
    </script>
</body>
</html>
