<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Spieler Details</title>
<style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; padding-bottom: 140px; margin: 0;}
    .navbar { background: linear-gradient(135deg, #34495e, #2c3e50); color: white; padding: 10px 15px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);}
    .player-header { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 1200px; margin: 0 auto; padding: 10px 0;}
    .player-center { display: flex; flex-direction: column; align-items: center; flex: 1;}
    .player-row { display: flex; align-items: center; gap: 12px; justify-content: center;}
    .club-logo { width: 44px; height: 44px; border-radius: 50%; background: #3498db; overflow: hidden; flex-shrink: 0; display: flex; align-items: center; justify-content: center;}
    .club-logo img { width: 100%; height: 100%; object-fit: contain;}
    .player-name { font-size: 22px; font-weight: bold; color: white; text-decoration: none; line-height: 1.1;}
    .player-name:hover { text-decoration: underline;}
    .player-id { font-size: 13px; color: #aaa; margin-top: 2px; text-align: left; width: 100%;}
    .status-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; flex-shrink: 0; gap: 2px;}
    .status-label { font-size: 12px; color: #aaa;}
    .status-indicator { font-size: 26px; cursor: help; transition: opacity 0.2s;}
    .status-indicator:hover { opacity: 0.8;}
    .container { max-width: 1200px; margin: 0 auto; padding: 15px;}
    .info-card { background: rgba(255,255,255,0.95); border-radius: 10px; padding: 0; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);}
    .info-card h3 { margin: 0; color: #fff; background: linear-gradient(90deg,#764ba2 60%,#667eea); border-radius: 10px 10px 0 0; padding: 16px 22px; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; transition: background 0.2s;}
    .info-card h3:after { content: "‚ñº"; font-size: 0.8em; margin-left: auto; display: inline-block; transition: transform 0.2s;}
    .info-card h3.collapsed:after { transform: rotate(-90deg);}
    .info-card .stat-icon { width: 22px; height: 22px; vertical-align: middle; margin-right: 6px; }
    .info-card-content { overflow: hidden; max-height: 1000px; transition: max-height 0.3s ease-out; padding: 15px 20px 10px 20px;}
    .info-card-content.collapsed { max-height: 0; padding: 0 20px;}
    .info-row { display: flex; justify-content: space-between; margin-bottom: 8px; padding: 5px 0; border-bottom: 1px solid #eee;}
    .info-row:last-child { border-bottom: none;}
    .info-label { font-weight: 600; color: #7f8c8d; font-size: 13px; flex: 1;}
    .info-value { font-weight: 600; color: #2c3e50; font-size: 13px; flex: 1; text-align: right;}
    .attributes { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px;}
    .attribute-tag { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; padding: 4px 8px; border-radius: 15px; font-size: 12px; font-weight: 600;}
    .tabs { display: flex; justify-content: center; margin: 20px 0 0 0; border-bottom: 1px solid #ddd;}
    .tab-button { position:relative; padding: 10px 20px; background: #2c3e50; color: white; border: none; cursor: pointer; font-size: 22px; margin: 0 5px; border-radius: 16px 16px 0 0; transition: background 0.3s; display: flex; align-items: center;}
    .tab-button.active { background: #3498db;}
    .tab-button .trend-arrow { display: flex; align-items: center; margin-left: 7px;}
    .tab-content { display: none; padding: 15px; background: rgba(255,255,255,0.95); border-radius: 0 0 10px 10px;}
    .tab-content.active { display: block;}
    .rivals-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        font-size: 15px;
    }
    .rivals-table th, .rivals-table td {
        padding: 12px 10px;
        text-align: left;
        border-bottom: 1px solid #eee;
        font-size: 13px;
    }
    .rivals-table th {
        background-color: #2c3e50;
        color: white;
        font-weight: 600;
        cursor: pointer;
        user-select: none;
        position: relative;
        padding-right: 25px;
    }
    .rivals-table th:hover {
        background-color: #34495e;
    }
    .rivals-table tr:nth-child(even) { background-color: #f9f9f9; }
    .rivals-table tr:hover { background-color: #f1f7ff; }
    .player-name-cell { font-weight: 600; color: #2c3e50; }
    .player-id-cell { font-size: 11px; color: #aaa; margin-top: 2px; }
    .sort-arrow {
        position: absolute; right: 8px; top: 50%; transform: translateY(-50%); font-size: 12px;
    }
    .player-link { color: #3498db; text-decoration: underline; }
    .player-link:hover { color: #217dbb; }
    .points-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        background: #f9f9ff;
        border-radius: 10px;
        overflow: hidden;
        font-size: 15px;
    }
    .points-table th, .points-table td {
        padding: 10px;
        text-align: center;
        border-bottom: 1px solid #e3e7fa;
    }
    .points-table th {
        background: #e3e7fa;
        color: #2c3e50;
        font-weight: 600;
    }
    .points-table tr:nth-child(even) { background: #f6f8fa; }
    .points-table tr:hover { background: #eef2fa; }
    .matchday-cell { font-weight: 600; color: #2c3e50; }
    .points-cell { font-weight: 600; color: #27ae60; }
    .debug-panel {
        position: fixed;
        top: 10px;
        right: 10px;
        width: 300px;
        max-height: 500px;
        background: rgba(0,0,0,0.9);
        border-radius: 8px;
        color: #fff;
        font-family: monospace;
        font-size: 12px;
        z-index: 9999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .debug-header {
        background: #444;
        padding: 8px 12px;
        border-radius: 8px 8px 0 0;
        cursor: pointer;
        user-select: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
    }
    .debug-content {
        padding: 10px;
        max-height: 400px;
        overflow-y: auto;
        transition: max-height 0.3s ease;
    }
    .debug-content.collapsed {
        max-height: 0;
        padding: 0 10px;
        overflow: hidden;
    }
    .debug-entry {
        margin-bottom: 5px;
        padding: 3px 0;
        border-bottom: 1px solid #333;
    }
    .debug-timestamp {
        color: #888;
        font-size: 10px;
    }
    .debug-level-info { color: #4CAF50; }
    .debug-level-warn { color: #FF9800; }
    .debug-level-error { color: #F44336; }
    .debug-level-success { color: #8BC34A; }
    @media (max-width: 600px) {
        .container { padding: 5px; }
        .market-month-header { font-size: 14px; }
        .market-list-row { font-size: 13px; padding: 6px 8px; }
        .player-name { font-size: 16px; }
        .club-logo { width: 34px; height: 34px; }
        .tab-button { font-size: 16px; }
        .debug-panel { width: 250px; right: 5px; top: 5px; }
    }
</style>
</head>
<body>
<div class="debug-panel">
    <div class="debug-header" onclick="toggleDebug()">
        üêõ Debug Log <span id="debugToggle">‚ñº</span>
    </div>
    <div class="debug-content" id="debugContent"></div>
</div>

<nav class="navbar">
    <button class="back-btn" onclick="window.history.back()">‚Üê Zur√ºck</button>
    <div class="player-header">
        <div class="player-center">
            <div class="player-row">
                <div class="club-logo" id="clubLogo"></div>
                <div>
                    <a href="#" id="playerNameLink" class="player-name" target="_blank">Lade Spieler...</a>
                    <div id="playerId" class="player-id"></div>
                </div>
            </div>
        </div>
        <div class="status-wrapper">
            <div class="status-label">Status</div>
            <div id="statusIndicator" class="status-indicator"></div>
        </div>
    </div>
</nav>
<div class="container">
    <div id="errorMessage" class="error-message" style="display:none; color: red; font-weight: bold; margin-bottom: 10px;"></div>
    <div id="loadingIndicator" class="loading-spinner" style="text-align:center; padding: 20px;">Lade Daten...</div>
    <div id="playerContent" style="display:none;">
        <div class="info-card" id="card-info">
            <h3 id="header-info">üìã Spieler-Informationen</h3>
            <div class="info-card-content" id="content-info">
                <div class="info-row"><span class="info-label">Geburtstag:</span><span class="info-value" id="birthday">-</span></div>
                <div class="info-row"><span class="info-label">Alter:</span><span class="info-value" id="age">-</span></div>
                <div class="info-row"><span class="info-label">Gr√∂√üe:</span><span class="info-value" id="height">-</span></div>
                <div class="info-row"><span class="info-label">Nationalit√§t:</span><span class="info-value" id="nationality">-</span></div>
                <div class="info-row"><span class="info-label">Position:</span><span class="info-value" id="position">-</span></div>
                <div class="info-row"><span class="info-label">Hauptfu√ü:</span><span class="info-value" id="foot">-</span></div>
                <div class="info-row"><span class="info-label">Trikotnummer:</span><span class="info-value" id="jerseyNumber">-</span></div>
                <div class="info-row" id="ligainsiderRankingRow" style="display:none;">
                    <span class="info-label">Ligainsider Ranking:</span>
                    <span class="info-value" id="ligainsiderRankingValue">-</span>
                </div>
            </div>
        </div>
        <div class="info-card" id="card-comunio">
            <h3 id="header-comunio">‚öΩ Comunio</h3>
            <div class="info-card-content" id="content-comunio">
                <div class="info-row"><span class="info-label">Position:</span><span class="info-value" id="comunioPosition">-</span></div>
                <div class="info-row"><span class="info-label">Marktwert:</span><span class="info-value" id="marketValue">-</span></div>
                <div class="info-row"><span class="info-label">Punkte (letztes Jahr):</span><span class="info-value" id="pointsWithLastYear">-</span></div>
                <div class="info-row"><span class="info-label">Besitzer:</span><span class="info-value" id="owner">-</span></div>
            </div>
        </div>
        <div class="info-card" id="card-stats">
            <h3 id="header-stats"><svg class="stat-icon" viewBox="0 0 24 24" fill="none"><rect x="3" y="13" width="3" height="8" rx="1" fill="#764ba2"/><rect x="8" y="9" width="3" height="12" rx="1" fill="#764ba2"/><rect x="13" y="5" width="3" height="16" rx="1" fill="#764ba2"/><rect x="18" y="2" width="3" height="19" rx="1" fill="#764ba2"/></svg>Status & Statistik</h3>
            <div class="info-card-content" id="content-stats">
                <div class="info-row"><span class="info-label">Status:</span><span class="info-value" id="detailStatus">-</span></div>
                <div class="info-row"><span class="info-label">Spiele:</span><span class="info-value" id="gamesPlayed">-</span></div>
                <div class="info-row"><span class="info-label">Tore:</span><span class="info-value" id="goals">-</span></div>
                <div class="info-row"><span class="info-label">Notenschnitt:</span><span class="info-value" id="averageRating">-</span></div>
                <div class="info-row"><span class="info-label">Gelbe Karten:</span><span class="info-value" id="yellowCards">-</span></div>
                <div class="info-row"><span class="info-label">Rote Karten:</span><span class="info-value" id="redCards">-</span></div>
            </div>
        </div>
        <div class="info-card" id="attributesCard" style="display:none;">
            <h3 id="header-attr">‚≠ê Besondere Eigenschaften</h3>
            <div class="info-card-content" id="content-attr">
                <div class="attributes" id="attributesList"></div>
            </div>
        </div>
        <div class="tabs" id="tabBar">
            <button class="tab-button" data-tab="rivals">Rivalen</button>
            <button class="tab-button" data-tab="market">Marktwerte <span id="marketTabTrend" class="trend-arrow"></span></button>
            <button class="tab-button" data-tab="points">Punkte</button>
        </div>
        <div id="rivals" class="tab-content">
            <h3 id="rivalsHeader">Direkte Konkurrenten im Team</h3>
            <div id="rivalsList"></div>
        </div>
        <div id="market" class="tab-content">
            <div id="marketValueChart"></div>
        </div>
        <div id="points" class="tab-content">
            <div id="pointsHistory"></div>
        </div>
    </div>
</div>
<script>
// Debug Panel Logik bleibt wie gehabt

// Accordion: Immer nur eine Rubrik offen, erste standardm√§√üig offen
function setupAccordion() {
    const cards = document.querySelectorAll('.info-card');
    cards.forEach((card, idx) => {
        const header = card.querySelector('h3');
        const content = card.querySelector('.info-card-content');
        if (idx === 0) {
            content.classList.remove('collapsed');
            header.classList.remove('collapsed');
        } else {
            content.classList.add('collapsed');
            header.classList.add('collapsed');
        }
        header.onclick = () => {
            cards.forEach((c) => {
                const h = c.querySelector('h3');
                const cont = c.querySelector('.info-card-content');
                if (c !== card) {
                    cont.classList.add('collapsed');
                    h.classList.add('collapsed');
                }
            });
            content.classList.toggle('collapsed');
            header.classList.toggle('collapsed');
        };
    });
}

// Tabs: Marktwert, Punkte, Rivalen
function initTabs() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(tab => tab.classList.remove('active'));
            button.classList.add('active');
            const tabId = button.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });
    // Standard: Rivalen aktiv
    tabButtons.forEach(btn => btn.classList.remove('active'));
    tabContents.forEach(tab => tab.classList.remove('active'));
    document.querySelector('.tab-button[data-tab="rivals"]').classList.add('active');
    document.getElementById('rivals').classList.add('active');
}

// Ligainsider Ranking korrekt auslesen (aus verschachteltem Attribut-Array)
function getLigainsiderRankingObj(player) {
    if (!player || !player.data || !Array.isArray(player.data.attribute)) return null;
    for (const attr of player.data.attribute) {
        if (attr.ligainsiderRanking && typeof attr.ligainsiderRanking === 'object') {
            return attr.ligainsiderRanking;
        }
    }
    return null;
}

// Anzeige im Info-Panel und Header
function updateLigainsiderRanking(player) {
    const rankingObj = getLigainsiderRankingObj(player);
    const rankingRow = document.getElementById('ligainsiderRankingRow');
    const rankingValueSpan = document.getElementById('ligainsiderRankingValue');
    const playerInfoHeader = document.getElementById('header-info');
    if (rankingObj && rankingObj.rang !== undefined && rankingObj.rang !== null && rankingObj.rang !== 0 && rankingObj.rang !== '') {
        rankingRow.style.display = '';
        rankingValueSpan.textContent = rankingObj.rang;
        playerInfoHeader.innerHTML = `üìã Spieler-Informationen <span style="font-size:14px;font-weight:400;padding-left:8px;">(Ligainsider Ranking: <b>${rankingObj.rang}</b>)</span>`;
    } else {
        rankingRow.style.display = 'none';
        rankingValueSpan.textContent = '-';
        playerInfoHeader.innerHTML = 'üìã Spieler-Informationen';
    }
}

// Hilfsfunktion f√ºr Rivalen-Sortierung
function getRivalRanking(player) {
    const obj = getLigainsiderRankingObj(player);
    return (obj && obj.rang !== undefined && obj.rang !== null && obj.rang !== 0 && obj.rang !== '') ? obj.rang : Number.MAX_SAFE_INTEGER;
}

// Rivalen-Tabelle mit Ligainsider Ranking als 2. Spalte, korrekt sortiert
function displayRivals(player, allPlayers) {
    const container = document.getElementById('rivalsList');
    const header = document.getElementById('rivalsHeader');
    const rivals = allPlayers.filter(p =>
        p.data?.position === player.data?.position &&
        p.data?.verein === player.data?.verein
    );
    rivals.sort((a, b) => getRivalRanking(a) - getRivalRanking(b));
    header.textContent = `${rivals.length} Direkte Konkurrenten im Team`;
    let html = `
    <table class="rivals-table">
        <thead>
            <tr>
                <th>Spieler</th>
                <th>Ligainsider Ranking</th>
                <th>Status</th>
                <th>Marktwert</th>
                <th>Realwert</th>
                <th>Punkte</th>
                <th>Besitzer</th>
            </tr>
        </thead>
        <tbody>
    `;
    rivals.forEach(rival => {
        const rankingObj = getLigainsiderRankingObj(rival);
        const ligRank = (rankingObj && rankingObj.rang !== 0 && rankingObj.rang !== undefined && rankingObj.rang !== null && rankingObj.rang !== '') ? rankingObj.rang : '-';
        html += `
        <tr>
            <td>${rival.name}</td>
            <td>${ligRank}</td>
            <td>${rival.data?.status || '-'}</td>
            <td>${rival.data?.wert ? rival.data?.wert.toLocaleString('de-DE') + ' ‚Ç¨' : '-'}</td>
            <td>${rival.data?.realWert ? rival.data?.realWert.toLocaleString('de-DE') + ' ‚Ç¨' : '-'}</td>
            <td>${rival.data?.punkte || '-'}</td>
            <td>${rival.data?.besitzer || '-'}</td>
        </tr>
        `;
    });
    html += '</tbody></table>';
    container.innerHTML = html;
}

// Nach dem Laden der Daten aufrufen:
document.addEventListener('DOMContentLoaded', function() {
    setupAccordion();
    initTabs();
    // Nach Laden der Spielerdaten:
    // updateLigainsiderRanking(player);
    // displayRivals(player, allPlayers);
    // ... weitere Funktionen wie displayMarketValue(player), displayPointsHistory(player) etc.
});

/*
  Dokumentation:
  - setupAccordion(): Immer nur eine Rubrik offen, erste standardm√§√üig offen.
  - initTabs(): Tabs f√ºr Rivalen, Marktwerte, Punkte.
  - getLigainsiderRankingObj(): Holt das Ligainsider Ranking-Objekt aus player.data.attribute.
  - updateLigainsiderRanking(): Zeigt das Ranking unter Spielerinfos und im Header, wenn vorhanden.
  - displayRivals(): Rivalen-Tabelle, sortiert nach Ligainsider Ranking (null/0/"" ganz unten).
  - KEINE Beispieldaten enthalten. Nutze deine Datenbank wie gehabt.
  - Nach dem Laden deiner Daten rufst du updateLigainsiderRanking(player), displayRivals(player, allPlayers) usw. auf.
  - Die Panels f√ºr Marktwerte und Punkte sind als Tabs vorhanden. F√ºlle sie mit deinen bestehenden displayMarketValue(player) und displayPointsHistory(player) Funktionen.
*/
</script>
</body>
</html>
